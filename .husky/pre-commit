#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Enforce Node version from .nvmrc to avoid ESLint (v7) failing under newer majors
PROJECT_NODE_REQUIRED=$(cat .nvmrc | tr -d '[:space:]')
CURRENT_NODE_MAJOR=$(node -p "process.versions.node.split('.')[0]")
REQUIRED_NODE_MAJOR=$(printf "%s" "$PROJECT_NODE_REQUIRED" | cut -d'.' -f1)

if [ "$CURRENT_NODE_MAJOR" != "$REQUIRED_NODE_MAJOR" ]; then
	echo "\n[pre-commit] Expected Node $PROJECT_NODE_REQUIRED (major $REQUIRED_NODE_MAJOR) but found $(node -v)." >&2
	echo "Run: nvm use $PROJECT_NODE_REQUIRED (or install it first: nvm install $PROJECT_NODE_REQUIRED)" >&2
	echo "Aborting commit to prevent ESLint crash under mismatched Node version." >&2
	exit 1
fi

npm run lint-staged
